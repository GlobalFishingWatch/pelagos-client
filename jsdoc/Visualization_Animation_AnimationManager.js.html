<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Visualization/Animation/AnimationManager.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Visualization/Animation/AnimationManager.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>define([
  "app/Class",
  "app/Events",
  "app/Bounds",
  "app/Timerange",
  "app/SpaceTime",
  "app/ObjectTemplate",
  "shims/async/main",
  "shims/lodash/main",
  "app/Logging",
  "app/Visualization/KeyModifiers",
  "app/Visualization/KeyBindings",
  "shims/jQuery/main",
  "dijit/Dialog",
  "app/Visualization/Animation/Matrix",
  "shims/CanvasLayer/main",
  "shims/Stats/main",
  "app/Visualization/Animation/ObjectToTable",
  "app/Visualization/Animation/Rowidx",
  "app/Visualization/Animation/Animation",
  "app/Visualization/Animation/PointAnimation",
  "app/Visualization/Animation/LineAnimation",
  "app/Visualization/Animation/LineStripAnimation",
  "app/Visualization/Animation/TileAnimation",
  "app/Visualization/Animation/DebugAnimation",
  "app/Visualization/Animation/ClusterAnimation",
  "app/Visualization/Animation/MapsEngineAnimation",
  "app/Visualization/Animation/CartoDBAnimation",
  "app/Visualization/Animation/VesselTrackAnimation",
  "app/Visualization/Animation/ArrowAnimation",
  "app/Visualization/Animation/SatelliteAnimation"],
function(Class,
  Events,
  Bounds,
  Timerange,
  SpaceTime,
  ObjectTemplate,
  async,
  _,
  Logging,
  KeyModifiers,
  KeyBindings,
  $,
  Dialog,
  Matrix,
  CanvasLayer,
  Stats,
  ObjectToTable,
  Rowidx,
  Animation
) {
  var AnimationManager = Class({
    name: "AnimationManager",

    mapOptions: {
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      zoomControlOptions: {
        position: google.maps.ControlPosition.LEFT_TOP,
        style: google.maps.ZoomControlStyle.LARGE
      },
      mapTypeControl: false,
      streetViewControl: false,
      overviewMapControl: false,
      styles: [
        {
          featureType: 'poi',
          stylers: [{visibility: 'off'}]
        }
      ]
    },

    initialize: function (visualization) {
      var self = this;

      self.events = new Events("AnimationManager");

      self.visualization = visualization;
      self.node = $("&lt;div class='animations' style='width: 100%; height: 100%;'>");
      self.visualization.node.append(self.node);

      self.indrag = false;
      self.inPanZoom = false;
      self.animationIdCounter = 0;
    },

    init: function (cb) {
      var self = this;

      self.animations = [];
      self.updateNeeded = false;
      self.lastUpdate = undefined;
      self.map = undefined;
      self.canvasLayer = undefined;
      self.gl = undefined;
      self.pixelsToWebGLMatrix = new Float32Array(16);
      self.googleMercator2webglMatrix = new Float32Array(16);

      async.series([
        self.initMap.bind(self),
        self.initOverlay.bind(self),
        self.initCanvas.bind(self),
        self.initStats.bind(self),
        self.initMouse.bind(self),
        self.initUpdates.bind(self),
        function (cb) {
          self.initialized = true;
          cb();
        }
      ], cb);
    },

    initStats: function (cb) {
      var self = this;

      /* bgein stats */
      self.stats = new Stats();
      self.stats.setMode(0); // 0: fps, 1: ms
      // Align top-left
      self.stats.domElement.style.position = 'absolute';
      self.stats.domElement.style.left = '0px';
      self.stats.domElement.style.top = '0px';
      /* end stats */

      if (self.visualization.state.getValue("stats") == 'true') {
        document.body.appendChild(self.stats.domElement);
      }

      cb();
    },

    initMap: function (cb) {
      var self = this;

      self.map = new google.maps.Map(
        self.node[0],
        $.extend(
          {
            zoom: 1,
            center: {lat: 0, lng: 0}
          },
          self.mapOptions
        )
      );

      window.addEventListener('resize', self.windowSizeChanged.bind(self), false);
      google.maps.event.addListener(self.map, 'tilesloaded', self.tilesLoaded.bind(self));
      google.maps.event.addListener(self.map, 'center_changed', self.centerChanged.bind(self));
      google.maps.event.addListener(self.map, 'zoom_changed', self.zoomChanged.bind(self));
      google.maps.event.addListener(self.map, 'bounds_changed', self.boundsChanged.bind(self));
      google.maps.event.addListener(self.map, 'dragstart', function () { self.indrag = true; });
      google.maps.event.addListener(self.map, 'dragend', function () { self.indrag = false; self.boundsChanged(); });

      cb();
    },

    tilesLoaded: function() {    
      var self = this;

      /* FIXME: We a way set focus to handle keyboard combinations...
       * Not sure how it should work. The following works for initial
       * focus, but generates a spurious and broken selection event.
       * self.node.children().children().first().children().trigger('click');
       */
    },

    initOverlay: function (cb) {
      var self = this;

      var overlay = self.visualization.state.getValue("overlay")
      if (overlay) {
        var kmlLayer = new google.maps.KmlLayer({url: overlay, preserveViewport: true});
        kmlLayer.setMap(self.map);
      }
      cb();
    },

    handleNoGl: function () {
      var self = this;
      var failover = self.visualization.state.getValue('nowebgl');
      if (failover) {
        window.location = failover;
      } else {
        self.dialog = new Dialog({
          title: "Loading failed",
          content: '' +
            '&lt;b class="error">Your browser does not support WebGL&lt;/b>',
          actionBarTemplate: '' +
            '&lt;div class="dijitDialogPaneActionBar" data-dojo-attach-point="actionBarNode">' +
            '  &lt;button data-dojo-type="dijit/form/Button" type="submit" data-dojo-attach-point="closeButton">Close&lt;/button>' +
            '&lt;/div>'
        });
        $(self.dialog.closeButton).on('click', function () {
          self.dialog.hide();
        });
        self.dialog.show();
      }
      throw new AnimationManager.NoGlError();
    },

    getGlContext: function (canvas) {
      var self = this;
      var gl = canvas.getContext('experimental-webgl', {preserveDrawingBuffer: true});
      if (!gl) self.handleNoGl();
      gl.enable(gl.BLEND);
      return gl;
    },

    createRowidxGlContext: function () {
      var self = this;
      var canvas = document.createElement('canvas');
      var gl = self.getGlContext(canvas);
      gl.clearColor(1.0, 1.0, 1.0, 1.0);
      return gl;
    },

    initCanvas: function (cb) {
      var self = this;

      var canvasLayerOptions = {
        map: self.map,
        resizeHandler: function () { if (self.initialized) self.canvasResize() },
        updateHandler: function () { if (self.initialized) self.update(); },
        animate: true
      };
      self.canvasLayer = new CanvasLayer(canvasLayerOptions);

      try {
        self.gl = self.getGlContext(self.canvasLayer.canvas);

        self.rowidxGl = [self.createRowidxGlContext(), self.createRowidxGlContext()];
      } catch (e) {
        if (e instanceof AnimationManager.NoGlError) {
          cb({msg: "Your browser does not support WebGL."});
        } else {
           throw e;
        }
      }

      var onAdd = function () {
        if (!self.canvasLayer.isAdded_) {
          setTimeout(onAdd, 1);
        } else {
          self.canvasResize();
          cb();
        }
      }
      onAdd();
    },

    search: function(query, offset, limit, cb) {
      var self = this;

      Logging.main.log(
        "Visualization.Animation.AnimationManager.search",
        {
          query: query,
          offset: offset,
          limit: limit,
          toString: function () {
            var offsetLog = this.offset ? this.offset.toString() : "NULL";
            var limitLog = this.limit ? this.limit.toString() : "NULL";
            return this.query + " [" + offsetLog + " / " + limitLog + "]";
          }
        }
      );

      searchers = [];
      for (var key in self.animations) {
        var animation = self.animations[key];
        if (animation.search &amp;&amp; !animation.selectionAnimationFor) {
          searchers.push(animation.search.bind(animation));
        }
      }

      var res = {total: 0, entries: []};
      async.each(searchers, function (searcher, cb) {
        searcher(query, offset, limit, function (err, item) {
          if (err) return cb(err);
          if (item) {
            var tmp =_.extend({}, res, item);
            tmp.total = res.total + item.total;
            tmp.entries = res.entries.concat(item.entries);
            res = tmp;
          }
          cb(null);
        });
      }, function (err) {
        cb(err, err ? null : res);
      });
    },

    /* Uses the selectionGl canvases to get a source animation, tile
     * id and rowid from a pixel x/y position. */
    getRowidxAtPos: function (x, y) {
      var self = this;

      /* Canvas coordinates are upside down for some reason... */
      y = self.canvasLayer.canvas.height - y;

      return Rowidx.pixelToId(
        Rowidx.appendByteArrays.apply(
          undefined,
          self.rowidxGl.map(function (gl) {
            var data = new Uint8Array(4);
            gl.readPixels(x, y, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, data);
            return data.subarray(0, 3); /* Disregard Alpha for now... Unsure how it interacts with BLEND functions... */
          })
        )
      );
    },

    getReportableAnimation: function() {
      var self = this;

      var predicate = function(animation) {
        var hasSourceUrl =
          animation.args &amp;&amp;
          animation.args.source &amp;&amp;
          animation.args.source.args &amp;&amp;
          animation.args.source.args.url;

        var isReportable =
          animation.args &amp;&amp;
          animation.args.reportable

        return hasSourceUrl &amp;&amp; isReportable;
      };

     return _.find(self.animations, predicate);
    },

    handleMouse: function (e, type) {
      var self = this;

      var x, y;

      if (e.pageX != undefined) {
        var offset = self.node.offset();
        x = e.pageX - offset.left;
        y = e.pageY - offset.top;
      } else {
        x = e.pixel.x;
        y = e.pixel.y;
      }

      var rowidx = self.getRowidxAtPos(x, y);


      Logging.main.log(
        "Visualization.Animation.AnimationManager.handleMouse",
        {
          x: x,
          y: y,
          rowidx: rowidx,
          toString: function () {
            if (this.rowidx != undefined) {
              return this.x.toString() + "," + this.y.toString() + ": " + JSON.stringify(this.rowidx);
            } else {
              return this.x.toString() + "," + this.y.toString() + ": NO OBJECT";
            }
          }
        }
      );

      if (rowidx) {
        var animation = self.animations[rowidx[0]];
        if (animation &amp;&amp; animation.data_view) {
          animation.data_view.selections.selections[type].rawInfo = KeyModifiers.active.Shift;
        }

        if (animation &amp;&amp; animation.select([rowidx[1], rowidx[2]], type, true, e)) {
          return animation;
        }
      } else {
        self.animations.map(function (animation) {
          animation.select(undefined, type, true, e);
        });
      }
      return false;
    },

    hideAllSelectionAnimations: function () {
      var self = this;

      var animations = self.animations.slice(0);
      for (var i = 0; i &lt; animations.length; i++) {
        self.hideSelectionAnimations(animations[i]);
      }
    },

    hideSelectionAnimations: function (baseAnimation) {
      var self = this;

      if (baseAnimation.selectionAnimations != undefined) {
        baseAnimation.selectionAnimations.map(function (selectionAnimation) {
          self.removeAnimation(selectionAnimation);
        });
      }
      baseAnimation.selectionAnimations = [];
    },

    showSelectionAnimations: function (baseAnimation, selection) {
      var self = this;
      var baseHeader = baseAnimation.data_view.source.header;

      if (!baseHeader.seriesTilesets) return;

      self.hideSelectionAnimations(baseAnimation);

      if (selection.data.series != undefined || selection.data.seriesgroup != undefined) {
        var seriesTilesets = baseAnimation.args.seriesTilesets;

        if (!seriesTilesets) {
          seriesTilesets = baseHeader.seriesTilesets;
        }

        if (seriesTilesets === true) {
          seriesTilesets = [
            {
              "type": "VesselTrackAnimation",
              "args": {
                "title": "Vessel Track",
                "color": "grey",
                "visible": true,
                "source": {
                  "type": "TiledBinFormat",
                  "args": {
                    "url": "%(query_url)s"
                  }
                }
              }
            }
          ];
        }

        var query = baseAnimation.data_view.source.getSelectionQuery(selection);
        seriesTilesets = new ObjectTemplate(seriesTilesets).eval({
          url: baseAnimation.data_view.source.url,
          versioned_url: baseAnimation.data_view.source.getUrl('sub', query, -1),
          query_url: baseAnimation.data_view.source.getSelectionUrl(selection, -1),
          query: query,
          header: baseAnimation.data_view.source.header,
          selection: selection
        });

        self.hideSelectionAnimations(baseAnimation);

        var seriesAnimations = [];
        async.each(seriesTilesets, function (seriesTileset, cb) {
          self.addAnimation(
            seriesTileset,
            function (err, animation) {
              if (err) {
                self.removeAnimation(animation);
              } else {
                animation.selectionAnimationFor = baseAnimation;
                baseAnimation.selectionAnimations.push(animation);
                seriesAnimations.push(animation);
              }
              cb();
            }
          );
        }, function (err) {
          if (selection.data.zoomToSelectionAnimations != undefined) {
            var bounds = new SpaceTime();
            seriesAnimations.map(function (animation) {
              bounds.update(new Timerange([
                animation.data_view.source.header.colsByName.datetime.min,
                animation.data_view.source.header.colsByName.datetime.max]));
              bounds.update(new Bounds([
                animation.data_view.source.header.colsByName.longitude.min,
                animation.data_view.source.header.colsByName.latitude.min,
                animation.data_view.source.header.colsByName.longitude.max,
                animation.data_view.source.header.colsByName.latitude.max]));
            });

            self.visualization.state.setValue("time", bounds.getTimerange().end);
            self.visualization.state.setValue("timeExtent", bounds.getTimerange().end.getTime() - bounds.getTimerange().start.getTime());
            bounds = bounds.getBounds();
            self.visualization.animations.map.fitBounds({
              south:bounds.bottom,
              west:bounds.left,
              north:bounds.top,
              east:bounds.right
            });
            delete selection.data.zoomToSelectionAnimations;
          }            
        });
      }
    },

    initMouse: function(cb) {
      var self = this;

      KeyBindings.register(
        [], 'left click (on object)', 'Map',
        'Show object information in the sidebar'
      );
      KeyBindings.register(
        [], 'right click (on object)', 'Map',
        'Show object information in a popup'
      );
      KeyBindings.register(
        ['Shift'], 'left click (on object)', 'Map',
        'Show raw object information (no server query) in the sidebar'
      );
      KeyBindings.register(
        ['Shift'], 'right click (on object)', 'Map',
        'Show raw object information (no server query) in popup'
      );

      self.infoPopup = new google.maps.InfoWindow({});

      self.node.mousemove(function (e) {
        if (!self.indrag) self.handleMouse(e, 'hover');
      });

      google.maps.event.addListener(self.map, "click", function(e) {
        self.handleMouse(e, 'selected');
        if (e.preventDefault) e.preventDefault();
        if (e.stopPropagation) e.stopPropagation();
      });
      google.maps.event.addListener(self.map, "rightclick", function(e) {
        e.pageX = e.pixel.x;
        e.pageY = e.pixel.y;
        
        self.handleMouse(e, 'info');
        if (e.preventDefault) e.preventDefault();
        if (e.stopPropagation) e.stopPropagation();
      });
      cb();
    },

    initUpdates: function (cb) {
      var self = this;

      self.visualization.state.events.on({
        set: self.triggerUpdate,
        lat: self.panZoom,
        lon: self.panZoom,
        zoom: self.panZoom,
        time: self.dataNeedsChanged,
        timeExtent:self.dataNeedsChanged,
        scope: self
      });
      cb();
    },

    addAnimationInstance: function (animationInstance, cb) {
      var self = this;

      animationInstance.id = self.animationIdCounter++;
      animationInstance.addingToManager = true;
      animationInstance.initGl(function () { 
        animationInstance.initUpdates(function () {
          if (animationInstance.addingToManager) {
            animationInstance.addingToManager = false;
            self.animations.push(animationInstance);
            self.triggerUpdate();
            if (animationInstance.data_view) {
              animationInstance.data_view.selections.events.on({
                "add": self.handleSelectionUpdate.bind(
                  self, animationInstance)
              });
              animationInstance.data_view.selections.retriggerSelectionEvents();
            }
            self.events.triggerEvent("add", {animation: animationInstance});
          }
          cb(null, animationInstance);
        });
      });
    },

    handleInfo: function (animation, type, err, data, selectionData) {
      var self = this;
      var dataView = animation.data_view;
 
      Logging.main.log(
        "Visualization.Animation.AnimationManager.handleInfo",
        {
          layer: animation.title,
          category: type,
          data: data,
          toString: function () {
            return this.layer + "/" + this.category + ": " + this.data.toString();
          }
        }
      );

      if (type == 'info') {
        if (err) data = err;
        if (!data) return;

        self.infoPopup.setOptions({
          content: data.toString(),
          position: {lat: selectionData.latitude,
                     lng: selectionData.longitude}
        });
        self.infoPopup.open(self.map);
      } else {
        var category;
        var event = {
          layerInstance: animation,
          layer: animation.title,
          category: type,
          selection: selectionData
        }

        if (err) {
          category = 'info-error';
          event.data = err;
          event.toString = function () { return this.data.toString(); };
        } else if (data &amp;&amp; data.error) {
          category = 'info-error';
          event.data = data.error;
          event.toString = function () { return this.data.toString(); };
        } else if (data) {
          category = 'info';
          event.data = data;
          event.toString = function () { return this.data.toString(); };
        } else {
          category = 'info';
          event.data = data;
          event.toString = function () { return 'Nothing selected'; };
        }

        self.events.triggerEvent(category, event);
      }
    },

    handleSelectionInfo: function (animation, selectionEvent, err, data) {
      var self = this;
      var dataView = animation.data_view;
      var type = selectionEvent.category;
      var info = {};
      var selectionData = dataView.selections.selections[type].data;
      for (var key in selectionData) {
        info[key] = selectionData[key][0];
      }
      self.handleInfo(animation, type, err, data, info);
    },

    handleSelectionUpdate: function (animation, selectionEvent, type) {
      var self = this;
      var dataView = animation.data_view;
      var type = selectionEvent.category;
      var selection = dataView.selections.selections[type];

      if (type != 'selected' &amp;&amp; type != 'info') return;

      Logging.main.log(
        "Visualization.Animation.AnimationManager.handleSelectionUpdate",
        {
          layer: animation.title,
          category: type,
          query: animation.data_view.source.getSelectionQuery(selection),
          toString: function () {
            return this.layer + "/" + this.category + ": " + this.query;
          }
        }
      );

      if (type == 'selected') {
        self.events.triggerEvent('info-loading', {});
        if (dataView.source.header.seriesTilesets) {
          self.hideAllSelectionAnimations();
        }

        if (   (selectionEvent.startidx == undefined || selectionEvent.endidx == undefined)
            &amp;&amp; (selectionEvent.startData == undefined || selectionEvent.endData == undefined)) {
          var data = {};
          data.toString = function () { return ""; };
          self.handleSelectionInfo(animation, selectionEvent, null, undefined);
        }
      }

      if (   (selectionEvent.startidx == undefined || selectionEvent.endidx == undefined)
          &amp;&amp; (selectionEvent.startData == undefined || selectionEvent.endData == undefined)) {
        return;
      }

      if (selection.rawInfo) {
        var data = _.clone(selection.data);
        data.layer = animation.title;
        data.toString = function () {
          return ObjectToTable(this);
        };
        self.handleSelectionInfo(animation, selectionEvent, null, data);
      } else if (!selection.hasSelectionInfo()) {
        var data = {
          layer: animation.title,
          toString: function () {
            return 'Cluster selected.';
          }
        };
        self.handleSelectionInfo(animation, selectionEvent, null, data);
      } else {
        if (type == 'selected') {
          self.showSelectionAnimations(animation, selection);
        }
        dataView.selections.getSelectionInfo(type, function (err, data) {
          var content;

          if (err) {
            self.handleSelectionInfo(animation, selectionEvent, err, null);
          } else if (data) {
            data.toString = function () {
              var content = ["&lt;table class='table table-striped table-bordered'>"];
              if (data.name) {
                var name = data.name;
                if (data.link) {
                  name = "&lt;a target='_new' href='" + data.link + "'>" + name + "&lt;/a>";
                }
                content.push("&lt;tr>&lt;th colspan='2'>" + name + "&lt;/th>&lt;tr>");
              }

              Object.keys(data).sort().map(function (key) {
                if (key == 'toString' || key == 'name' || key == 'link') return;
                if (typeof(data[key])=="string" &amp;&amp; data[key].indexOf("://") != -1) {
                  content.push("&lt;tr>&lt;th colspan='2'>&lt;a target='_new' href='" + data[key] +  "'>" + key + "&lt;/a>&lt;/th>&lt;/tr>");
                } else {
                  content.push("&lt;tr>&lt;th>" + key + "&lt;/th>&lt;td>" + data[key] + "&lt;/td>&lt;/tr>");
                }
              });

              content.push("&lt;/table>");

              return content.join('\n');
            };
            self.handleSelectionInfo(animation, selectionEvent, null, data);
          } else {
            // We got an error call before, but now something has
            // changed and we're retrying the load...
            self.events.triggerEvent('info-loading', {});
          }
        });

      }
    },

    addAnimation: function (animation, cb) {
      var self = this;
      self.addAnimationInstance(
        new Animation.animationClasses[animation.type](
          self, animation.args
        ),
        cb
      );
    },

    removeAnimation: function (animation) {
      var self = this;
      if (animation.addingToManager) {
        animation.addingToManager = false;
      } else {
        self.animations = self.animations.filter(function (a) { return a !== animation; });
        self.events.triggerEvent("remove", {animation: animation});
        animation.destroy();
        self.triggerUpdate();
      }
    },

    windowSizeChanged: function () {
      var self = this;
      google.maps.event.trigger(self.map, 'resize');
    },

    panZoom: function () {
      var self = this;

      if (!self.inPanZoom) {
        self.map.setCenter({
          lat: self.visualization.state.getValue("lat"),
          lng: self.visualization.state.getValue("lon")
        });
        self.map.setZoom(self.visualization.state.getValue("zoom"));
      }
    },

    centerChanged: function() {
      var self = this;
      self.inPanZoom = true;
      self.visualization.state.setValue("lat", self.map.getCenter().lat());
      self.visualization.state.setValue("lon", self.map.getCenter().lng());
      self.inPanZoom = false;
      self.triggerUpdate();
    },

    zoomChanged: function() {
      var self = this;
      self.inPanZoom = true;
      self.visualization.state.setValue("zoom", self.map.getZoom());
      self.inPanZoom = false;
      self.triggerUpdate();
    },

    boundsChanged: function() {
      var self = this;

      if (self.indrag) return;
      self.dataNeedsChanged();
    },

    dataNeedsChanged: function() {
      var self = this;
      var bounds = self.map.getBounds();
      var ne = bounds.getNorthEast();
      var sw = bounds.getSouthWest();
      var latmin = sw.lat();
      var lonmin = sw.lng();
      var latmax = ne.lat();
      var lonmax = ne.lng();
      var bounds = new Bounds([lonmin, latmin, lonmax, latmax]);

      var end = self.visualization.state.getValue("time");
      if (end == undefined) return;

      var start = new Date(end.getTime() - self.visualization.state.getValue("timeExtent"));
      var range = new Timerange([start, end]);

      self.visualization.data.zoomTo(new SpaceTime(range, bounds));
    },

    canvasResize: function() {
      var self = this;

      if (!self.gl) return;

      var width = self.canvasLayer.canvas.width;
      var height = self.canvasLayer.canvas.height;

      self.gl.viewport(0, 0, width, height);

      // matrix which maps pixel coordinates to WebGL coordinates
      self.pixelsToWebGLMatrix.set([
        2/width, 0,         0, 0,
        0,       -2/height, 0, 0,
        0,       0,         0, 0,
        -1,      1,         0, 1
      ]);

      self.updateNeeded = true;
    },

    updateTime: function (header, paused) {
      var self = this;

      self.stats.begin();

      if (paused) {
        self.lastUpdate = undefined;
      } else {
        var timeExtent = self.visualization.state.getValue("timeExtent");
        var time = self.visualization.state.getValue("time").getTime();
        var min = header.colsByName.datetime.min;
        var max = header.colsByName.datetime.max;
        var timeNow = new Date().getTime();
        var timePerTimeExtent = self.visualization.state.getValue("length");

        var timePerAnimationTime = timePerTimeExtent / timeExtent;

        if (self.lastUpdate != undefined) {
          var time = (timeNow - self.lastUpdate) / timePerAnimationTime + time;
          self.visualization.state.setValue("time", new Date(time));
        }
        self.lastUpdate = timeNow;
      }
    },

    updateProjection: function () {
      var self = this;

      /**
       * We need to create a transformation that takes world coordinate
       * points in the pointArrayBuffer to the coodinates WebGL expects.
       * 1. Start with second half in pixelsToWebGLMatrix, which takes pixel
       *     coordinates to WebGL coordinates.
       * 2. Scale and translate to take world coordinates to pixel coords
       * see https://developers.google.com/maps/documentation/javascript/maptypes#MapCoordinate
       */

      var mapProjection = self.map.getProjection();

      // copy pixel->webgl matrix
      self.googleMercator2webglMatrix.set(self.pixelsToWebGLMatrix);

      var scale = self.canvasLayer.getMapScale();
      Matrix.scaleMatrix(self.googleMercator2webglMatrix, scale, scale);

      var translation = self.canvasLayer.getMapTranslation();
      Matrix.translateMatrix(self.googleMercator2webglMatrix, translation.x, translation.y);
    },

    isPaused: function () {
      var self = this;
      return self.visualization.state.getValue("paused");
    },

    update: function() {
      var self = this;

      if (!self.gl) return;

      var time = self.visualization.state.getValue("time");
      var paused = self.visualization.state.getValue("paused");
      if (!self.visualization.data.header.colsByName.datetime) paused = true;
      if (!paused) {
        var min = self.visualization.data.header.colsByName.datetime.min;
        var max = self.visualization.data.header.colsByName.datetime.max;
        if (time &lt; min || time > max) paused = true;
      }

      if (!self.updateNeeded &amp;&amp; paused) {
        return;
      }
      self.updateNeeded = false;

      var width = self.canvasLayer.canvas.width;
      var height = self.canvasLayer.canvas.height;

      self.rowidxGl.map(function (gl) {
        gl.canvas.width = width;
        gl.canvas.height = height;
        gl.viewport(0, 0, width, height);
        gl.clear(gl.COLOR_BUFFER_BIT);
      });

      self.updateTime(self.visualization.data.header, paused);
      self.updateProjection();

      self.gl.clear(self.gl.COLOR_BUFFER_BIT);

      Logging.main.log("Visualization.Animation.AnimationManager.update", {
        toString: function () {
          return (this.time != undefined ? this.time.rfcstring(" ") : "undefined")
            + " [" + (this.timeExtent != undefined ? this.timeExtent.toString() : "undefined") + "]";
        },
        timeExtent: self.visualization.state.getValue("timeExtent"),
        time: time
      });

      self.animations.map(function (animation) { animation.draw(); });

      self.stats.end();
    },

    triggerUpdate: function (e) {
      var self = this;

      Logging.main.log("Visualization.Animation.AnimationManager.triggerUpdate", {msg: "Trigger update"});

      self.updateNeeded = true;
    },

    setMapOptions: function (options) {
      var self = this;

      options = $.extend({}, options);
      delete options.zoom;
      delete options.center;

      self.mapOptions = options;
      self.map.setOptions(options);
    },

    load: function (animations, cb) {
      var self = this;
      self.animations.map(function (animation) {
        self.events.triggerEvent("remove", {animation: animation});
        animation.destroy();
      });
      self.animations = [];

      if (animations.options) {
        self.setMapOptions(animations.options);
      }

      async.map(animations.animations, self.addAnimation.bind(self), cb || function () {});
    },

    toJSON: function () {
      var self = this;

      return {animations: self.animations.filter(function (animation) {
                return animation.selectionAnimationFor == undefined;
              }).map(function (animation) {
                return animation.toJSON()
              }),
              options: self.mapOptions};
    }
  });

  AnimationManager.NoGlError = function () { Error.call(this); };
  AnimationManager.NoGlError.prototype = new Error();
  AnimationManager.NoGlError.prototype.name = "NoGlError";

  return AnimationManager;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Bounds.html">Bounds</a></li><li><a href="CanvasLayer.html">CanvasLayer</a></li><li><a href="Condition.html">Condition</a></li><li><a href="CountryCodes.html">CountryCodes</a></li><li><a href="Data_Ajax.html">Data/Ajax</a></li><li><a href="Data_BaseTiledFormat.html">Data/BaseTiledFormat</a></li><li><a href="Data_BaseTiledFormat_DataContainer.html">Data/BaseTiledFormat:DataContainer</a></li><li><a href="Data_BinFormat.html">Data/BinFormat</a></li><li><a href="Data_CartoDBInfoWindow.html">Data/CartoDBInfoWindow</a></li><li><a href="Data_ClusterTestFormat.html">Data/ClusterTestFormat</a></li><li><a href="Data_DataManager.html">Data/DataManager</a></li><li><a href="Data_DataView.html">Data/DataView</a></li><li><a href="Data_EmptyFormat.html">Data/EmptyFormat</a></li><li><a href="Data_Format.html">Data/Format</a></li><li><a href="Data_GeoProjection.html">Data/GeoProjection</a></li><li><a href="Data_Pack.html">Data/Pack</a></li><li><a href="Data_Selection.html">Data/Selection</a></li><li><a href="Data_SelectionManager.html">Data/SelectionManager</a></li><li><a href="Data_Tile.html">Data/Tile</a></li><li><a href="Data_TileBounds.html">Data/TileBounds</a></li><li><a href="Data_TiledBinFormat.html">Data/TiledBinFormat</a></li><li><a href="Data_TiledEmptyFormat.html">Data/TiledEmptyFormat</a></li><li><a href="Data_TypedMatrixGenerator.html">Data/TypedMatrixGenerator</a></li><li><a href="Data_TypedMatrixParser.html">Data/TypedMatrixParser</a></li><li><a href="Events.html">Events</a></li><li><a href="Json.html">Json</a></li><li><a href="LoadingInfo.html">LoadingInfo</a></li><li><a href="Logging.html">Logging</a></li><li><a href="Logging_Destination.html">Logging/Destination</a></li><li><a href="Logging_GoogleAnalyticsDestination.html">Logging/GoogleAnalyticsDestination</a></li><li><a href="Logging_LogglyDestination.html">Logging/LogglyDestination</a></li><li><a href="Logging_ScreenDestination.html">Logging/ScreenDestination</a></li><li><a href="Logging_ServerDestination.html">Logging/ServerDestination</a></li><li><a href="Logging_StoreDestination.html">Logging/StoreDestination</a></li><li><a href="Logging_Logging__Entry.html">Logging:Logging__Entry</a></li><li><a href="ObjectTemplate.html">ObjectTemplate</a></li><li><a href="PopupAuth.html">PopupAuth</a></li><li><a href="SpaceTime.html">SpaceTime</a></li><li><a href="SubscribableDict.html">SubscribableDict</a></li><li><a href="Test.html">Test</a></li><li><a href="Test_BaseTest.html">Test/BaseTest</a></li><li><a href="Test_Data_BinFormat.html">Test/Data/BinFormat</a></li><li><a href="Test_Data_DataView.html">Test/Data/DataView</a></li><li><a href="Test_Data_TiledEmptyFormat.html">Test/Data/TiledEmptyFormat</a></li><li><a href="Test_Data_TypedMatrixParser.html">Test/Data/TypedMatrixParser</a></li><li><a href="Test_Events.html">Test/Events</a></li><li><a href="Test_Logging.html">Test/Logging</a></li><li><a href="Test_SubscribableDict.html">Test/SubscribableDict</a></li><li><a href="Test_SubscribableDict_OtherType.html">Test/SubscribableDict:OtherType</a></li><li><a href="Test_SubscribableDict_TestType.html">Test/SubscribableDict:TestType</a></li><li><a href="Timerange.html">Timerange</a></li><li><a href="UrlValues.html">UrlValues</a></li><li><a href="Visualization_Animation_Animation.html">Visualization/Animation/Animation</a></li><li><a href="Visualization_Animation_AnimationManager.html">Visualization/Animation/AnimationManager</a></li><li><a href="Visualization_Animation_ArrowAnimation.html">Visualization/Animation/ArrowAnimation</a></li><li><a href="Visualization_Animation_CartoDBAnimation.html">Visualization/Animation/CartoDBAnimation</a></li><li><a href="Visualization_Animation_ClusterAnimation.html">Visualization/Animation/ClusterAnimation</a></li><li><a href="Visualization_Animation_DataAnimation.html">Visualization/Animation/DataAnimation</a></li><li><a href="Visualization_Animation_DebugAnimation.html">Visualization/Animation/DebugAnimation</a></li><li><a href="Visualization_Animation_LineAnimation.html">Visualization/Animation/LineAnimation</a></li><li><a href="Visualization_Animation_LineStripAnimation.html">Visualization/Animation/LineStripAnimation</a></li><li><a href="Visualization_Animation_MapsEngineAnimation.html">Visualization/Animation/MapsEngineAnimation</a></li><li><a href="Visualization_Animation_Matrix.html">Visualization/Animation/Matrix</a></li><li><a href="Visualization_Animation_PointAnimation.html">Visualization/Animation/PointAnimation</a></li><li><a href="Visualization_Animation_Rowidx.html">Visualization/Animation/Rowidx</a></li><li><a href="Visualization_Animation_SatelliteAnimation.html">Visualization/Animation/SatelliteAnimation</a></li><li><a href="Visualization_Animation_Shader.html">Visualization/Animation/Shader</a></li><li><a href="Visualization_Animation_TileAnimation.html">Visualization/Animation/TileAnimation</a></li><li><a href="Visualization_Animation_VesselTrackAnimation.html">Visualization/Animation/VesselTrackAnimation</a></li><li><a href="Visualization_KeyBindings.html">Visualization/KeyBindings</a></li><li><a href="Visualization_KeyModifiers.html">Visualization/KeyModifiers</a></li><li><a href="Visualization_UI_BasicSidebar.html">Visualization/UI/BasicSidebar</a></li><li><a href="Visualization_UI_SidePanels_SidePanelManager_InfoUI.html">Visualization/UI/SidePanels/SidePanelManager:InfoUI</a></li><li><a href="Visualization_UI_UIManager_UI.html">Visualization/UI/UIManager:UI</a></li><li><a href="Visualization_Visualization.html">Visualization/Visualization</a></li></ul><h3>Global</h3><ul><li><a href="global.html#%2522border-color%2522">"border-color"</a></li><li><a href="global.html#%2522info-error%2522">"info-error"</a></li><li><a href="global.html#%2522info-loading%2522">"info-loading"</a></li><li><a href="global.html#%2522tile-error%2522">"tile-error"</a></li><li><a href="global.html#__all__">__all__</a></li><li><a href="global.html#__jsonclass__">__jsonclass__</a></li><li><a href="global.html#_buttonNode">_buttonNode</a></li><li><a href="global.html#_getBaseTemplateContext">_getBaseTemplateContext</a></li><li><a href="global.html#_getMultivaluedTemplateContext">_getMultivaluedTemplateContext</a></li><li><a href="global.html#_getPolygonFieldKeys">_getPolygonFieldKeys</a></li><li><a href="global.html#_onBlur">_onBlur</a></li><li><a href="global.html#_selector">_selector</a></li><li><a href="global.html#_setAnimationAttr">_setAnimationAttr</a></li><li><a href="global.html#_setChoicesAttr">_setChoicesAttr</a></li><li><a href="global.html#_setDestinationRulesAttr">_setDestinationRulesAttr</a></li><li><a href="global.html#_setDragHandlesAttr">_setDragHandlesAttr</a></li><li><a href="global.html#_setEndLabelPositionAttr">_setEndLabelPositionAttr</a></li><li><a href="global.html#_setLabelPositionAttr">_setLabelPositionAttr</a></li><li><a href="global.html#_setLengthLabelPositionAttr">_setLengthLabelPositionAttr</a></li><li><a href="global.html#_setRuleAttr">_setRuleAttr</a></li><li><a href="global.html#_setSourcenameAttr">_setSourcenameAttr</a></li><li><a href="global.html#_setStartLabelPositionAttr">_setStartLabelPositionAttr</a></li><li><a href="global.html#_setupDownloadLink">_setupDownloadLink</a></li><li><a href="global.html#_setupReportLink">_setupReportLink</a></li><li><a href="global.html#_setValueAttr">_setValueAttr</a></li><li><a href="global.html#_setZoomPositionAttr">_setZoomPositionAttr</a></li><li><a href="global.html#_updateContainerNode">_updateContainerNode</a></li><li><a href="global.html#_updateContainerWithCustomInfo">_updateContainerWithCustomInfo</a></li><li><a href="global.html#_updateContainerWithVesselInfo">_updateContainerWithVesselInfo</a></li><li><a href="global.html#_updateTitle">_updateTitle</a></li><li><a href="global.html#actionBarTemplate">actionBarTemplate</a></li><li><a href="global.html#activateSearch">activateSearch</a></li><li><a href="global.html#active">active</a></li><li><a href="global.html#active_category">active_category</a></li><li><a href="global.html#activeKeys">activeKeys</a></li><li><a href="global.html#add">add</a></li><li><a href="global.html#addCartoDBAnimation">addCartoDBAnimation</a></li><li><a href="global.html#addFromLibrary">addFromLibrary</a></li><li><a href="global.html#addHandler">addHandler</a></li><li><a href="global.html#all">all</a></li><li><a href="global.html#allLoaded">allLoaded</a></li><li><a href="global.html#animation">animation</a></li><li><a href="global.html#animationFilter">animationFilter</a></li><li><a href="global.html#animations">animations</a></li><li><a href="global.html#anumber">anumber</a></li><li><a href="global.html#app">app</a></li><li><a href="global.html#args">args</a></li><li><a href="global.html#around">around</a></li><li><a href="global.html#astring">astring</a></li><li><a href="global.html#atesttype">atesttype</a></li><li><a href="global.html#attr0">attr0</a></li><li><a href="global.html#attrmapper">attrmapper</a></li><li><a href="global.html#background">background</a></li><li><a href="global.html#backgroundCss">backgroundCss</a></li><li><a href="global.html#baseClass">baseClass</a></li><li><a href="global.html#batch">batch</a></li><li><a href="global.html#bbox">bbox</a></li><li><a href="global.html#beginEdit">beginEdit</a></li><li><a href="global.html#bottom">bottom</a></li><li><a href="global.html#bounds">bounds</a></li><li><a href="global.html#buf%255Bundefined%255D">buf[undefined]</a></li><li><a href="global.html#buildRendering">buildRendering</a></li><li><a href="global.html#cachedTileLoading">cachedTileLoading</a></li><li><a href="global.html#cachedTileLoading_pre">cachedTileLoading_pre</a></li><li><a href="global.html#calculateStepSize">calculateStepSize</a></li><li><a href="global.html#category">category</a></li><li><a href="global.html#center">center</a></li><li><a href="global.html#change">change</a></li><li><a href="global.html#choices">choices</a></li><li><a href="global.html#class">class</a></li><li><a href="global.html#clear">clear</a></li><li><a href="global.html#clearFilter">clearFilter</a></li><li><a href="global.html#close">close</a></li><li><a href="global.html#cmp">cmp</a></li><li><a href="global.html#col">col</a></li><li><a href="global.html#colLoaded">colLoaded</a></li><li><a href="global.html#color">color</a></li><li><a href="global.html#colors">colors</a></li><li><a href="global.html#cols">cols</a></li><li><a href="global.html#column">column</a></li><li><a href="global.html#columns">columns</a></li><li><a href="global.html#complete_ancestor">complete_ancestor</a></li><li><a href="global.html#constraints">constraints</a></li><li><a href="global.html#constructor">constructor</a></li><li><a href="global.html#content">content</a></li><li><a href="global.html#contentTemplate">contentTemplate</a></li><li><a href="global.html#contentTime">contentTime</a></li><li><a href="global.html#context">context</a></li><li><a href="global.html#controlButtons">controlButtons</a></li><li><a href="global.html#cookie">cookie</a></li><li><a href="global.html#count">count</a></li><li><a href="global.html#css">css</a></li><li><a href="global.html#cssStateNodes">cssStateNodes</a></li><li><a href="global.html#data">data</a></li><li><a href="global.html#data%255Bundefined%255D%255Bundefined%255D">data[undefined][undefined]</a></li><li><a href="global.html#dataview">dataview</a></li><li><a href="global.html#date">date</a></li><li><a href="global.html#datetime">datetime</a></li><li><a href="global.html#days">days</a></li><li><a href="global.html#decreaseSpeed">decreaseSpeed</a></li><li><a href="global.html#design">design</a></li><li><a href="global.html#destination">destination</a></li><li><a href="global.html#destinationRules">destinationRules</a></li><li><a href="global.html#destroy">destroy</a></li><li><a href="global.html#dir">dir</a></li><li><a href="global.html#disabled">disabled</a></li><li><a href="global.html#discreteValues">discreteValues</a></li><li><a href="global.html#Display">Display</a></li><li><a href="global.html#display">display</a></li><li><a href="global.html#displayAnimationLibraryDialog">displayAnimationLibraryDialog</a></li><li><a href="global.html#displayAnimationsForSource">displayAnimationsForSource</a></li><li><a href="global.html#displayHelpDialog">displayHelpDialog</a></li><li><a href="global.html#displayPerformanceDialog">displayPerformanceDialog</a></li><li><a href="global.html#displaySearchDialog">displaySearchDialog</a></li><li><a href="global.html#displaySearchResults">displaySearchResults</a></li><li><a href="global.html#divide">divide</a></li><li><a href="global.html#drag">drag</a></li><li><a href="global.html#drag_moveTimeline_multiTouch">drag_moveTimeline_multiTouch</a></li><li><a href="global.html#drag_moveTimeline_pointer">drag_moveTimeline_pointer</a></li><li><a href="global.html#drag_windowResizeLeft">drag_windowResizeLeft</a></li><li><a href="global.html#drag_windowResizeRight">drag_windowResizeRight</a></li><li><a href="global.html#dragEnd">dragEnd</a></li><li><a href="global.html#dragEnd_moveTimeline_multiTouch">dragEnd_moveTimeline_multiTouch</a></li><li><a href="global.html#dragEnd_moveTimeline_pointer">dragEnd_moveTimeline_pointer</a></li><li><a href="global.html#dragEnd_windowResizeLeft">dragEnd_windowResizeLeft</a></li><li><a href="global.html#dragEnd_windowResizeRight">dragEnd_windowResizeRight</a></li><li><a href="global.html#dragHandles">dragHandles</a></li><li><a href="global.html#dragStart">dragStart</a></li><li><a href="global.html#dragStart_moveTimeline">dragStart_moveTimeline</a></li><li><a href="global.html#dragStart_moveTimeline_multiTouch">dragStart_moveTimeline_multiTouch</a></li><li><a href="global.html#dragStart_moveTimeline_pointer">dragStart_moveTimeline_pointer</a></li><li><a href="global.html#dragStart_windowResizeLeft">dragStart_windowResizeLeft</a></li><li><a href="global.html#dragStart_windowResizeRight">dragStart_windowResizeRight</a></li><li><a href="global.html#dropDown">dropDown</a></li><li><a href="global.html#dropDownDefaultValue">dropDownDefaultValue</a></li><li><a href="global.html#east">east</a></li><li><a href="global.html#eatEvent">eatEvent</a></li><li><a href="global.html#edit">edit</a></li><li><a href="global.html#editAnimation">editAnimation</a></li><li><a href="global.html#editRangeEnd">editRangeEnd</a></li><li><a href="global.html#EmptyWidget">EmptyWidget</a></li><li><a href="global.html#end">end</a></li><li><a href="global.html#endData">endData</a></li><li><a href="global.html#endEdit">endEdit</a></li><li><a href="global.html#endidx">endidx</a></li><li><a href="global.html#endLabelPosition">endLabelPosition</a></li><li><a href="global.html#endLabelTitle">endLabelTitle</a></li><li><a href="global.html#error">error</a></li><li><a href="global.html#eventAction">eventAction</a></li><li><a href="global.html#eventCategory">eventCategory</a></li><li><a href="global.html#eventLabel">eventLabel</a></li><li><a href="global.html#featureType">featureType</a></li><li><a href="global.html#filterBySelection">filterBySelection</a></li><li><a href="global.html#firstEvent">firstEvent</a></li><li><a href="global.html#floorDate">floorDate</a></li><li><a href="global.html#foo">foo</a></li><li><a href="global.html#format">format</a></li><li><a href="global.html#formatDate">formatDate</a></li><li><a href="global.html#formatInterval">formatInterval</a></li><li><a href="global.html#fullDates">fullDates</a></li><li><a href="global.html#getDirectory">getDirectory</a></li><li><a href="global.html#getEditorClass">getEditorClass</a></li><li><a href="global.html#getFilter">getFilter</a></li><li><a href="global.html#getFirstPosition">getFirstPosition</a></li><li><a href="global.html#getItemList">getItemList</a></li><li><a href="global.html#getNextStepLength">getNextStepLength</a></li><li><a href="global.html#getPrevStepLength">getPrevStepLength</a></li><li><a href="global.html#getReportUrl">getReportUrl</a></li><li><a href="global.html#getXorder">getXorder</a></li><li><a href="global.html#handleAccept">handleAccept</a></li><li><a href="global.html#handleCancel">handleCancel</a></li><li><a href="global.html#handler">handler</a></li><li><a href="global.html#handleSelectionChange">handleSelectionChange</a></li><li><a href="global.html#hasDownArrow">hasDownArrow</a></li><li><a href="global.html#header">header</a></li><li><a href="global.html#headerLoaded">headerLoaded</a></li><li><a href="global.html#headerTime">headerTime</a></li><li><a href="global.html#height">height</a></li><li><a href="global.html#hiddenContext">hiddenContext</a></li><li><a href="global.html#hitType">hitType</a></li><li><a href="global.html#hours">hours</a></li><li><a href="global.html#href">href</a></li><li><a href="global.html#i%255Bundefined%255D">i[undefined]</a></li><li><a href="global.html#id">id</a></li><li><a href="global.html#idCounter">idCounter</a></li><li><a href="global.html#img">img</a></li><li><a href="global.html#includeDatePrefix">includeDatePrefix</a></li><li><a href="global.html#inclusive">inclusive</a></li><li><a href="global.html#increaseSpeed">increaseSpeed</a></li><li><a href="global.html#info">info</a></li><li><a href="global.html#infowindow">infowindow</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#intensityChange">intensityChange</a></li><li><a href="global.html#intermediateChanges">intermediateChanges</a></li><li><a href="global.html#interval">interval</a></li><li><a href="global.html#intervalPrecision">intervalPrecision</a></li><li><a href="global.html#intervalPrecisionLimit">intervalPrecisionLimit</a></li><li><a href="global.html#intervals">intervals</a></li><li><a href="global.html#intervalToIndex">intervalToIndex</a></li><li><a href="global.html#intervalUnits">intervalUnits</a></li><li><a href="global.html#invertedRule">invertedRule</a></li><li><a href="global.html#key">key</a></li><li><a href="global.html#keyDown">keyDown</a></li><li><a href="global.html#keydown">keydown</a></li><li><a href="global.html#keys">keys</a></li><li><a href="global.html#keyup">keyup</a></li><li><a href="global.html#label">label</a></li><li><a href="global.html#lang">lang</a></li><li><a href="global.html#lat">lat</a></li><li><a href="global.html#layer">layer</a></li><li><a href="global.html#layerId">layerId</a></li><li><a href="global.html#left">left</a></li><li><a href="global.html#length">length</a></li><li><a href="global.html#lengthLabelPosition">lengthLabelPosition</a></li><li><a href="global.html#lengthLabelTitle">lengthLabelTitle</a></li><li><a href="global.html#limit">limit</a></li><li><a href="global.html#liveSplitters">liveSplitters</a></li><li><a href="global.html#lng">lng</a></li><li><a href="global.html#load">load</a></li><li><a href="global.html#loaded">loaded</a></li><li><a href="global.html#LoaderIcon">LoaderIcon</a></li><li><a href="global.html#loadTilesForZomm">loadTilesForZomm</a></li><li><a href="global.html#logging">logging</a></li><li><a href="global.html#logglyKey">logglyKey</a></li><li><a href="global.html#logo">logo</a></li><li><a href="global.html#lon">lon</a></li><li><a href="global.html#loop">loop</a></li><li><a href="global.html#map">map</a></li><li><a href="global.html#margin">margin</a></li><li><a href="global.html#matrix%255B0%255D">matrix[0]</a></li><li><a href="global.html#matrix%255B1%255D">matrix[1]</a></li><li><a href="global.html#matrix%255B2%255D">matrix[2]</a></li><li><a href="global.html#matrix%255B3%255D">matrix[3]</a></li><li><a href="global.html#matrix%255B4%255D">matrix[4]</a></li><li><a href="global.html#matrix%255B5%255D">matrix[5]</a></li><li><a href="global.html#matrix%255B6%255D">matrix[6]</a></li><li><a href="global.html#matrix%255B7%255D">matrix[7]</a></li><li><a href="global.html#matrix%255B12%255D">matrix[12]</a></li><li><a href="global.html#matrix%255B13%255D">matrix[13]</a></li><li><a href="global.html#matrix%255B14%255D">matrix[14]</a></li><li><a href="global.html#matrix%255B15%255D">matrix[15]</a></li><li><a href="global.html#max">max</a></li><li><a href="global.html#maximum">maximum</a></li><li><a href="global.html#maxWindowSize">maxWindowSize</a></li><li><a href="global.html#maybeEndEdit">maybeEndEdit</a></li><li><a href="global.html#menuFor">menuFor</a></li><li><a href="global.html#milliseconds">milliseconds</a></li><li><a href="global.html#min">min</a></li><li><a href="global.html#minimum">minimum</a></li><li><a href="global.html#minutes">minutes</a></li><li><a href="global.html#minWindowSize">minWindowSize</a></li><li><a href="global.html#monthNames">monthNames</a></li><li><a href="global.html#months">months</a></li><li><a href="global.html#move">move</a></li><li><a href="global.html#msg">msg</a></li><li><a href="global.html#name">name</a></li><li><a href="global.html#neverJustHours">neverJustHours</a></li><li><a href="global.html#newBounds">newBounds</a></li><li><a href="global.html#newWantedTiles">newWantedTiles</a></li><li><a href="global.html#noFilterTitle">noFilterTitle</a></li><li><a href="global.html#north">north</a></li><li><a href="global.html#offset">offset</a></li><li><a href="global.html#oldBounds">oldBounds</a></li><li><a href="global.html#oldWantedTiles">oldWantedTiles</a></li><li><a href="global.html#onCancel">onCancel</a></li><li><a href="global.html#onChange">onChange</a></li><li><a href="global.html#onClick">onClick</a></li><li><a href="global.html#onClose">onClose</a></li><li><a href="global.html#onExecute">onExecute</a></li><li><a href="global.html#onMouseLeave">onMouseLeave</a></li><li><a href="global.html#openDropDown">openDropDown</a></li><li><a href="global.html#options">options</a></li><li><a href="global.html#orientation">orientation</a></li><li><a href="global.html#out%255B0%255D">out[0]</a></li><li><a href="global.html#out%255B1%255D">out[1]</a></li><li><a href="global.html#out%255B2%255D">out[2]</a></li><li><a href="global.html#out%255B3%255D">out[3]</a></li><li><a href="global.html#out%255B4%255D">out[4]</a></li><li><a href="global.html#out%255B5%255D">out[5]</a></li><li><a href="global.html#out%255B6%255D">out[6]</a></li><li><a href="global.html#out%255B7%255D">out[7]</a></li><li><a href="global.html#out%255B8%255D">out[8]</a></li><li><a href="global.html#out%255B9%255D">out[9]</a></li><li><a href="global.html#out%255B10%255D">out[10]</a></li><li><a href="global.html#out%255B11%255D">out[11]</a></li><li><a href="global.html#out%255B12%255D">out[12]</a></li><li><a href="global.html#out%255B13%255D">out[13]</a></li><li><a href="global.html#out%255B14%255D">out[14]</a></li><li><a href="global.html#out%255B15%255D">out[15]</a></li><li><a href="global.html#overflow">overflow</a></li><li><a href="global.html#pad">pad</a></li><li><a href="global.html#padWidths">padWidths</a></li><li><a href="global.html#params">params</a></li><li><a href="global.html#parse">parse</a></li><li><a href="global.html#paths">paths</a></li><li><a href="global.html#pattern">pattern</a></li><li><a href="global.html#pause">pause</a></li><li><a href="global.html#paused">paused</a></li><li><a href="global.html#pending">pending</a></li><li><a href="global.html#performSearch">performSearch</a></li><li><a href="global.html#pixelOffsetToTimeOffset">pixelOffsetToTimeOffset</a></li><li><a href="global.html#placeHolder">placeHolder</a></li><li><a href="global.html#play">play</a></li><li><a href="global.html#playControl">playControl</a></li><li><a href="global.html#popup">popup</a></li><li><a href="global.html#popupClass">popupClass</a></li><li><a href="global.html#position">position</a></li><li><a href="global.html#postCreate">postCreate</a></li><li><a href="global.html#preserveDrawingBuffer">preserveDrawingBuffer</a></li><li><a href="global.html#preserveViewport">preserveViewport</a></li><li><a href="global.html#printTree">printTree</a></li><li><a href="global.html#profile">profile</a></li><li><a href="global.html#query">query</a></li><li><a href="global.html#query_url">query_url</a></li><li><a href="global.html#queryQueyUp">queryQueyUp</a></li><li><a href="global.html#rangemarks">rangemarks</a></li><li><a href="global.html#rangeUpdated">rangeUpdated</a></li><li><a href="global.html#receiving">receiving</a></li><li><a href="global.html#recreateRangemarks">recreateRangemarks</a></li><li><a href="global.html#recreateTickmarks">recreateTickmarks</a></li><li><a href="global.html#recreateTickmarksLevel">recreateTickmarksLevel</a></li><li><a href="global.html#region">region</a></li><li><a href="global.html#rel">rel</a></li><li><a href="global.html#remove">remove</a></li><li><a href="global.html#removeHandler">removeHandler</a></li><li><a href="global.html#rendering">rendering</a></li><li><a href="global.html#report">report</a></li><li><a href="global.html#reportDialog">reportDialog</a></li><li><a href="global.html#request">request</a></li><li><a href="global.html#restrictednumber">restrictednumber</a></li><li><a href="global.html#result%255Bundefined%255D">result[undefined]</a></li><li><a href="global.html#reverseDates">reverseDates</a></li><li><a href="global.html#right">right</a></li><li><a href="global.html#root">root</a></li><li><a href="global.html#round">round</a></li><li><a href="global.html#rowidx">rowidx</a></li><li><a href="global.html#rowLoaded">rowLoaded</a></li><li><a href="global.html#rule">rule</a></li><li><a href="global.html#rules">rules</a></li><li><a href="global.html#scope">scope</a></li><li><a href="global.html#script">script</a></li><li><a href="global.html#search">search</a></li><li><a href="global.html#secondEvent">secondEvent</a></li><li><a href="global.html#seconds">seconds</a></li><li><a href="global.html#selectAnimation">selectAnimation</a></li><li><a href="global.html#selected">selected</a></li><li><a href="global.html#selection">selection</a></li><li><a href="global.html#selections">selections</a></li><li><a href="global.html#separators">separators</a></li><li><a href="global.html#series">series</a></li><li><a href="global.html#set">set</a></li><li><a href="global.html#setContextFromVisibleContext">setContextFromVisibleContext</a></li><li><a href="global.html#setDate">setDate</a></li><li><a href="global.html#setDateTime">setDateTime</a></li><li><a href="global.html#setDefaultTitle">setDefaultTitle</a></li><li><a href="global.html#setEditor">setEditor</a></li><li><a href="global.html#setExpanded">setExpanded</a></li><li><a href="global.html#setFilter">setFilter</a></li><li><a href="global.html#setLength">setLength</a></li><li><a href="global.html#setPaused">setPaused</a></li><li><a href="global.html#setRange">setRange</a></li><li><a href="global.html#setRangeFromOffset">setRangeFromOffset</a></li><li><a href="global.html#setRangemarks">setRangemarks</a></li><li><a href="global.html#setSlectValueFromFilter">setSlectValueFromFilter</a></li><li><a href="global.html#setTime">setTime</a></li><li><a href="global.html#setTimeFocus">setTimeFocus</a></li><li><a href="global.html#setVisible">setVisible</a></li><li><a href="global.html#setVisibleContextFromRange">setVisibleContextFromRange</a></li><li><a href="global.html#setWindowSize">setWindowSize</a></li><li><a href="global.html#share">share</a></li><li><a href="global.html#show">show</a></li><li><a href="global.html#showCenterLabelAtWidth">showCenterLabelAtWidth</a></li><li><a href="global.html#showRightLabelAtWidth">showRightLabelAtWidth</a></li><li><a href="global.html#sideBar">sideBar</a></li><li><a href="global.html#slider2val">slider2val</a></li><li><a href="global.html#snapZoomToTickmarks">snapZoomToTickmarks</a></li><li><a href="global.html#someEvent">someEvent</a></li><li><a href="global.html#sortcols">sortcols</a></li><li><a href="global.html#sortRules">sortRules</a></li><li><a href="global.html#source">source</a></li><li><a href="global.html#sourcename">sourcename</a></li><li><a href="global.html#sources">sources</a></li><li><a href="global.html#south">south</a></li><li><a href="global.html#spec">spec</a></li><li><a href="global.html#splitter">splitter</a></li><li><a href="global.html#splitTickmarksOnLargerUnitBoundaries">splitTickmarksOnLargerUnitBoundaries</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#startData">startData</a></li><li><a href="global.html#startidx">startidx</a></li><li><a href="global.html#startLabelPosition">startLabelPosition</a></li><li><a href="global.html#startLabelTitle">startLabelTitle</a></li><li><a href="global.html#startup">startup</a></li><li><a href="global.html#state">state</a></li><li><a href="global.html#status">status</a></li><li><a href="global.html#stepLength">stepLength</a></li><li><a href="global.html#stepLengthIndex">stepLengthIndex</a></li><li><a href="global.html#stepLengths">stepLengths</a></li><li><a href="global.html#stepZoom">stepZoom</a></li><li><a href="global.html#stopPropagation">stopPropagation</a></li><li><a href="global.html#store_stack">store_stack</a></li><li><a href="global.html#store_time">store_time</a></li><li><a href="global.html#style">style</a></li><li><a href="global.html#stylers">stylers</a></li><li><a href="global.html#subtractFrom">subtractFrom</a></li><li><a href="global.html#suppressInfoWindows">suppressInfoWindows</a></li><li><a href="global.html#template">template</a></li><li><a href="global.html#templates">templates</a></li><li><a href="global.html#templateString">templateString</a></li><li><a href="global.html#temporalExtents">temporalExtents</a></li><li><a href="global.html#temporalExtentsBase">temporalExtentsBase</a></li><li><a href="global.html#textDir">textDir</a></li><li><a href="global.html#tickmarkLabels">tickmarkLabels</a></li><li><a href="global.html#tile">tile</a></li><li><a href="global.html#tileLoading">tileLoading</a></li><li><a href="global.html#tilesPerScreen">tilesPerScreen</a></li><li><a href="global.html#time">time</a></li><li><a href="global.html#timeExtent">timeExtent</a></li><li><a href="global.html#timeFocus">timeFocus</a></li><li><a href="global.html#timeLabel">timeLabel</a></li><li><a href="global.html#timeline">timeline</a></li><li><a href="global.html#timelineMousedown">timelineMousedown</a></li><li><a href="global.html#timerange">timerange</a></li><li><a href="global.html#timeTask">timeTask</a></li><li><a href="global.html#title">title</a></li><li><a href="global.html#titleChanged">titleChanged</a></li><li><a href="global.html#toggle">toggle</a></li><li><a href="global.html#toJSON">toJSON</a></li><li><a href="global.html#top">top</a></li><li><a href="global.html#toString">toString</a></li><li><a href="global.html#type">type</a></li><li><a href="global.html#ui">ui</a></li><li><a href="global.html#uniforms">uniforms</a></li><li><a href="global.html#update">update</a></li><li><a href="global.html#updated">updated</a></li><li><a href="global.html#updatedHandler">updatedHandler</a></li><li><a href="global.html#updateList">updateList</a></li><li><a href="global.html#updateLoading">updateLoading</a></li><li><a href="global.html#url">url</a></li><li><a href="global.html#value">value</a></li><li><a href="global.html#values">values</a></li><li><a href="global.html#version">version</a></li><li><a href="global.html#versioned_url">versioned_url</a></li><li><a href="global.html#visibility">visibility</a></li><li><a href="global.html#visualization">visualization</a></li><li><a href="global.html#west">west</a></li><li><a href="global.html#width">width</a></li><li><a href="global.html#windowDragStart">windowDragStart</a></li><li><a href="global.html#windowEnd">windowEnd</a></li><li><a href="global.html#windowLengHoverLabels">windowLengHoverLabels</a></li><li><a href="global.html#windowLengLabels">windowLengLabels</a></li><li><a href="global.html#windowStart">windowStart</a></li><li><a href="global.html#windowTimeLabels">windowTimeLabels</a></li><li><a href="global.html#withCredentials">withCredentials</a></li><li><a href="global.html#x">x</a></li><li><a href="global.html#y">y</a></li><li><a href="global.html#years">years</a></li><li><a href="global.html#zoom">zoom</a></li><li><a href="global.html#zoomIn">zoomIn</a></li><li><a href="global.html#zoomOut">zoomOut</a></li><li><a href="global.html#zoomPosition">zoomPosition</a></li><li><a href="global.html#zoomSize">zoomSize</a></li><li><a href="global.html#zoomTo">zoomTo</a></li><li><a href="global.html#zoomWheel">zoomWheel</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
