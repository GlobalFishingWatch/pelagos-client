 #! /bin/bash

# Add the nodejs deb if nodejs is not installed
if command -v node >/dev/null 2>&1; then
  echo "Nodejs is already installed"
else
  curl -sL https://deb.nodesource.com/setup_0.12 | bash - 2>&1
fi

# Install requirements for integration testing
if command -v google-chrome >/dev/null 2>&1; then
  echo "Google chrome is already installed"
else
  wget -q -O - "https://dl-ssl.google.com/linux/linux_signing_key.pub" | apt-key add - 2>&1
  echo 'deb http://dl.google.com/linux/chrome/deb/ stable main' >> /etc/apt/sources.list.d/google-chrome.list
fi

# Install all required pacakges
apt-get update 2>&1
apt-get install -y nodejs unzip openjdk-6-jre xvfb chromium-browser google-chrome-stable libglapi-mesa libosmesa6 mesa-utils python python-dev python-pip git 2>&1

if command -v testem >/dev/null 2>&1; then
  echo "Testem is already installed"
else
  npm install testem -g 2>&1
fi

pip install -r $1requirements.txt 2>&1
pip install chromedriver_installer --install-option="--chromedriver-version=2.10" 2>&1
